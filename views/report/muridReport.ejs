<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Laporan Murid</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; font-family:'Poppins', sans-serif; }
    body { background:#fdfdfd; color:#333; min-height:100vh; }

    /* Navbar */
    nav { background:#ec4899; color:white; padding:.75rem 1rem; box-shadow:0 2px 6px rgba(0,0,0,.15); }
    .nav-container { display:flex; justify-content:space-between; align-items:center; max-width:1100px; margin:auto; }
    .logo { font-size:1.5rem; font-weight:bold; }
    nav ul { list-style:none; display:flex; gap:1rem; }
    nav ul li { position:relative; }
    nav ul li a { color:white; text-decoration:none; padding:.5rem .75rem; border-radius:5px; display:inline-block; transition:.3s; }
    nav ul li a:hover { background: rgba(255,255,255,.2); }
    nav ul li .dropdown { display:none; position:absolute; top:120%; left:0; background:white; min-width:160px; border-radius:6px; box-shadow:0 4px 10px rgba(0,0,0,.15); flex-direction:column; z-index:150; }
    nav ul li .dropdown a { padding:.6rem 1rem; color:#333; display:block; transition:.3s; }
    nav ul li .dropdown a:hover { background:#ffe4e6; }
    nav ul li.active > .dropdown { display:flex; }
    .hamburger { display:none; flex-direction:column; cursor:pointer; gap:4px; }
    .hamburger div { width:28px; height:3px; background:white; border-radius:2px; }
    .mobile-menu { display:none; flex-direction:column; gap:.5rem; background:#f472b6; padding:.75rem 1rem; }
    .mobile-menu a { color:white; text-decoration:none; padding:.5rem .75rem; border-radius:5px; display:block; transition:.3s; }
    .mobile-menu a:hover { background: rgba(255,255,255,.2); }
    .mobile-dropdown { display:none; flex-direction:column; margin-left:1rem; background:#fbcfe8; border-radius:6px; padding:.25rem 0; }
    .mobile-dropdown a { color:#9d174d; padding:.5rem 1rem; }

    /* Container */
    .container { max-width:950px; margin:30px auto; background:#fff; padding:25px; border-radius:12px; box-shadow:0 4px 8px rgba(0,0,0,.1); }
    h1,h2 { text-align:center; margin-bottom:20px; color:#ff4d88; }

    /* Form & header section */
    .header-section {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      flex-wrap: wrap;
      gap: 10px;
    }

    form { display: flex; gap: 10px; align-items: center; }
    input, select {
      padding: 6px 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    button {
      background-color: #ff4d88;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      transition: 0.2s;
    }
    button:hover { background-color: #e63973; }

    #printGuruBtn {
      background-color: #ec4899;
      font-weight: bold;
    }
    #printGuruBtn:hover {
      background-color: #db2777;
    }

    /* Tabel */
    .table-wrapper { overflow-x:auto; }
    table { width:100%; border-collapse:collapse; margin-top:15px; min-width:800px; }
    th, td { padding:12px; border:1px solid #ddd; text-align:center; }
    th { background:#ff4d88; color:#fff; }
    tr:nth-child(even) { background:#ffe6ef; }

    /* Tombol aksi */
    .aksi button {
      padding: 6px 12px;
      border-radius: 6px;
      border: none;
      font-weight: bold;
      cursor: pointer;
      transition: 0.2s;
      margin-right: 5px;
      margin-bottom: 5px;
    }
    .btn-edit { background-color: #4ade80; color: #fff; }
    .btn-edit:hover { background-color: #22c55e; }
    .btn-delete { background-color: #f87171; color: #fff; }
    .btn-delete:hover { background-color: #ef4444; }

    @media (max-width:768px) {
      nav ul { display:none; }
      .hamburger { display:flex; }
      .mobile-menu.active { display:flex; }
    }

    @media (max-width:600px) {
      .header-section {
        flex-direction: column;
        align-items: stretch;
      }
      form { flex-wrap: wrap; justify-content: center; }
      #printGuruBtn {
        align-self: flex-end;
      }
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav>
    <div class="nav-container">
      <div class="logo">Chun Qing Learning Center</div>
      <ul>
        <li id="menu-desktop"><a href="/menu">Menu</a></li>
        <li id="kelola-desktop">
          <a href="#" onclick="event.preventDefault()">Kelola â–¼</a>
          <div class="dropdown">
            <a href="/murid">Murid</a>
            <a href="/guru">Guru</a>
          </div>
        </li>
        <li><a href="/report">Laporan</a></li>
        <li><a href="/logout">Log Out</a></li>
      </ul>
      <div class="hamburger" id="hamburger"><div></div><div></div><div></div></div>
    </div>
    <div class="mobile-menu" id="mobile-menu">
      <a href="/menu">Menu</a>
      <a href="#" id="mobile-kelola-btn">Kelola â–¼</a>
      <div class="mobile-dropdown" id="mobile-kelola-dropdown">
        <a href="/murid">Murid</a>
        <a href="/guru">Guru</a>
      </div>
      <a href="/report">Laporan</a>
      <a href="/logout">Log Out</a>
    </div>
  </nav>

  <div class="container">
    <h1>Laporan Murid</h1>

    <% if (typeof error !== 'undefined' && error) { %>
      <p style="color:red;text-align:center;"><%= error %></p>
    <% } %>

    <!-- TABEL DAFTAR MURID -->
    <h2>Daftar Murid</h2>

    <!-- Header filter + PDF button -->
    <div class="header-section">
      <form action="/report/murid" method="GET">
        <input type="text"
          name="search"
          value="<%= typeof search !== 'undefined' ? search : '' %>"
          placeholder="Cari Nama Murid ...">

        <select name="filter">
          <option value="">Semua Mata Pelajaran</option>
          <option value="Mandarin" <%= filter === 'Mandarin' ? 'selected' : ''%>>Mandarin</option>
          <option value="Bimbel" <%= filter === 'Bimbel' ? 'selected' : ''%>>Bimbel</option>
          <option value="Inggris" <%= filter === 'Inggris' ? 'selected' : ''%>>Inggris</option>
          <option value="Callistung" <%= filter === 'Callistung' ? 'selected' : ''%>>Callistung</option>
        </select>

        <button type="submit">Terapkan</button>
      </form>

      <button id="printGuruBtn">ðŸ“„ Download PDF</button>
    </div>

    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Nama Lengkap</th>
            <th>Kelas</th>
            <th>Mata Pelajaran</th>
            <th>Tanggal Lahir</th>
            <th>Asal Sekolah</th>
          </tr>
        </thead>
        <tbody>
          <% if (murids.length === 0) { %>
            <tr><td colspan="6">Belum ada murid</td></tr>
          <% } else { %>
            <% murids.forEach(m => { %>
              <tr>
                <td><%= m.id %></td>
                <td><%= m.fullname %></td>
                <td><%= m.kelas %></td>
                <td><%= m.mapel %></td>
                <td><%= m.tgl_lahir %></td>
                <td><%= m.asal_sekolah %></td>
              </tr>
            <% }) %>
          <% } %>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Script -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const kelolaDesktop = document.getElementById("kelola-desktop");
      kelolaDesktop.querySelector("a").addEventListener("click", e => {
        e.preventDefault();
        kelolaDesktop.classList.toggle("active");
      });
      document.addEventListener("click", e => {
        if (!kelolaDesktop.contains(e.target)) kelolaDesktop.classList.remove("active");
      });

      const burger = document.getElementById("hamburger");
      const mobileMenu = document.getElementById("mobile-menu");
      const kelolaBtn = document.getElementById("mobile-kelola-btn");
      const kelolaDropdown = document.getElementById("mobile-kelola-dropdown");

      burger.addEventListener("click", () => mobileMenu.classList.toggle("active"));
      kelolaBtn.addEventListener("click", e => {
        e.preventDefault();
        kelolaDropdown.style.display = kelolaDropdown.style.display === "flex" ? "none" : "flex";
      });

      // PDF download
      document.getElementById("printGuruBtn").addEventListener("click", () => {
        const element = document.querySelector(".table-wrapper");
        const opt = {
          margin: 0.5,
          filename: 'Laporan_Murid.pdf',
          image: { type: 'jpeg', quality: 0.98 },
          html2canvas: { scale: 2 },
          jsPDF: { unit: 'in', format: 'a4', orientation: 'landscape' }
        };
        html2pdf().set(opt).from(element).save();
      });
    });
  </script>
</body>
</html>
